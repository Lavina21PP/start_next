generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model attachments {
  id             Int          @id @default(autoincrement())
  transaction_id Int
  file_path      String       @db.VarChar(255)
  created_at     DateTime     @default(now()) @db.Timestamp(0)
  transactions   transactions @relation(fields: [transaction_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "attachments_ibfk_1")

  @@index([transaction_id], map: "transaction_id")
}

model budgets {
  id           Int        @id @default(autoincrement())
  user_id      Int
  category_id  Int
  amount_limit Decimal    @db.Decimal(12, 2)
  period_month Int
  period_year  Int
  created_at   DateTime   @default(now()) @db.Timestamp(0)
  users        users      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "budgets_ibfk_1")
  categories   categories @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "budgets_ibfk_2")

  @@unique([user_id, category_id, period_month, period_year], map: "user_id")
  @@index([category_id], map: "category_id")
}

model categories {
  id                     Int                      @id @default(autoincrement())
  user_id                Int
  name                   String                   @db.VarChar(100)
  type                   categories_type
  icon                   String?                  @db.VarChar(50)
  created_at             DateTime                 @default(now()) @db.Timestamp(0)
  budgets                budgets[]
  users                  users                    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "categories_ibfk_1")
  recurring_transactions recurring_transactions[]
  transactions           transactions[]

  @@index([user_id], map: "user_id")
}

model recurring_transactions {
  id            Int                              @id @default(autoincrement())
  user_id       Int
  wallet_id     Int
  category_id   Int
  amount        Decimal                          @db.Decimal(12, 2)
  note          String?                          @db.VarChar(255)
  frequency     recurring_transactions_frequency
  next_run_date DateTime                         @db.Date
  created_at    DateTime                         @default(now()) @db.Timestamp(0)
  users         users                            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "recurring_transactions_ibfk_1")
  wallets       wallets                          @relation(fields: [wallet_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "recurring_transactions_ibfk_2")
  categories    categories                       @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "recurring_transactions_ibfk_3")

  @@index([category_id], map: "category_id")
  @@index([user_id], map: "user_id")
  @@index([wallet_id], map: "wallet_id")
}

model tags {
  id               Int                @id @default(autoincrement())
  user_id          Int
  name             String             @db.VarChar(50)
  created_at       DateTime           @default(now()) @db.Timestamp(0)
  users            users              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "tags_ibfk_1")
  transaction_tags transaction_tags[]

  @@unique([user_id, name], map: "user_id")
}

model transaction_tags {
  transaction_id Int
  tag_id         Int
  transactions   transactions @relation(fields: [transaction_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "transaction_tags_ibfk_1")
  tags           tags         @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "transaction_tags_ibfk_2")

  @@id([transaction_id, tag_id])
  @@index([tag_id], map: "tag_id")
}

model transactions {
  id               Int                @id @default(autoincrement())
  user_id          Int
  wallet_id        Int
  category_id      Int
  amount           Decimal            @db.Decimal(12, 2)
  note             String?            @db.VarChar(255)
  trans_date       DateTime           @db.Date
  created_at       DateTime           @default(now()) @db.Timestamp(0)
  attachments      attachments[]
  transaction_tags transaction_tags[]
  users            users              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "transactions_ibfk_1")
  wallets          wallets            @relation(fields: [wallet_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "transactions_ibfk_2")
  categories       categories         @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "transactions_ibfk_3")

  @@index([category_id], map: "category_id")
  @@index([user_id], map: "user_id")
  @@index([wallet_id], map: "wallet_id")
}

model users {
  id                     Int                      @id @default(autoincrement())
  username               String                   @unique(map: "username") @db.VarChar(100)
  email                  String                   @unique(map: "email") @db.VarChar(150)
  password_hash          String                   @db.VarChar(255)
  created_at             DateTime                 @default(now()) @db.Timestamp(0)
  budgets                budgets[]
  categories             categories[]
  recurring_transactions recurring_transactions[]
  tags                   tags[]
  transactions           transactions[]
  wallets                wallets[]
}

model wallets {
  id                     Int                      @id @default(autoincrement())
  user_id                Int
  name                   String                   @db.VarChar(100)
  balance                Int                      @default(0)
  type                   wallets_type?            @default(other)
  created_at             DateTime                 @default(now()) @db.Timestamp(0)
  recurring_transactions recurring_transactions[]
  transactions           transactions[]
  users                  users                    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "wallets_ibfk_1")

  @@index([user_id], map: "user_id")
}

enum categories_type {
  income
  expense
}

enum wallets_type {
  cash
  bank
  credit
  ewallet
  other
}

enum recurring_transactions_frequency {
  daily
  weekly
  monthly
  yearly
}
